---
layout: post
title: "From mutable loops to immutable folds"
---

<p>When we ask of <em>key-features</em> of functional programming, you will probably hear two things most often.
Immutability and recursion. But why is that so? As Immutability also becomes more important in OO
languages you will probably find a lot of reason for that one, but why are recursive
functions so important? The short answer is, because of Immutability! To understand the connection
between those, let's start with some code that uses loops with mutation.</p>
<h2>ResizeArray</h2>
<p>Let's start with <code>ResizeArray</code>, and let's implement a <code>map</code> for it. The interesting idea,
even if we have a <em>mutable data-structures</em> we still can write functions that behaves as
if we had <em>immutable data</em>. That means, we return new data, instead of <em>mutating</em> data.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="t">ResizeArray</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="f">map</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="f">f</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">oldArray</span> <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">newArray</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 7)" onmouseover="showTip(event, 'fs2', 7)" class="t">ResizeArray</span><span class="o">&lt;</span>_<span class="o">&gt;</span>()
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs5', 9)" onmouseover="showTip(event, 'fs5', 9)" class="i">oldArray</span> <span class="k">do</span>
            <span onmouseout="hideTip(event, 'fs6', 10)" onmouseover="showTip(event, 'fs6', 10)" class="i">newArray</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="f">Add</span> (<span onmouseout="hideTip(event, 'fs4', 12)" onmouseover="showTip(event, 'fs4', 12)" class="f">f</span> <span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="i">x</span>)
        <span onmouseout="hideTip(event, 'fs6', 14)" onmouseover="showTip(event, 'fs6', 14)" class="i">newArray</span>
</code></pre></td>
</tr>
</table>
<p>Now we can do stuff like this.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 15)" onmouseover="showTip(event, 'fs9', 15)" class="i">numbers</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 16)" onmouseover="showTip(event, 'fs10', 16)" class="t">ResizeArray</span><span class="o">&lt;</span>_<span class="o">&gt;</span>()
<span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="i">numbers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 18)" onmouseover="showTip(event, 'fs11', 18)" class="f">Add</span>(<span class="n">1</span>)
<span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="i">numbers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 20)" onmouseover="showTip(event, 'fs11', 20)" class="f">Add</span>(<span class="n">2</span>)
<span onmouseout="hideTip(event, 'fs9', 21)" onmouseover="showTip(event, 'fs9', 21)" class="i">numbers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 22)" onmouseover="showTip(event, 'fs11', 22)" class="f">Add</span>(<span class="n">3</span>)

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 23)" onmouseover="showTip(event, 'fs12', 23)" class="i">squaredNumbers</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 24)" onmouseover="showTip(event, 'fs10', 24)" class="t">ResizeArray</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 25)" onmouseover="showTip(event, 'fs3', 25)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs13', 27)" onmouseover="showTip(event, 'fs13', 27)" class="i">x</span> <span class="o">*</span> <span class="n">2</span>) <span onmouseout="hideTip(event, 'fs9', 28)" onmouseover="showTip(event, 'fs9', 28)" class="i">numbers</span>
</code></pre></td>
</tr>
</table>
<p>We now have two <code>ResizeArray</code>. <code>numbers</code> containing the numbers <code>1</code>, <code>2</code> and <code>3</code>. And <code>squaredNumbers</code>
containing <code>2</code>, <code>4</code>, <code>6</code>. So while this behaves like <em>immutability</em>, it still isn't exactly
<em>immutable</em>. We also see that in the <code>map</code> implementation. In <code>map</code> we first create
an empty <em>mutable</em> <code>newArray</code>. While we loop over <code>oldArray</code> we add the new elements to <code>newArray</code>.
But adding new stuff to <code>newArray</code> is only possible because <code>newArray</code> is <em>mutable</em>!</p>
<p>But what do we do if we have a true <em>immutable list</em> like the built-in F# list? We cannot start with
an <code>empty list</code> just loop over <code>oldArray</code> and directly add an element to the empty list. We only can
create a new list by pre-pending an element.</p>
<p>But where do we save it? Sure we can assign it to a new variable. But it doesn't
make much sense to just create a new list inside of a loop. Actually F# supports <em>mutable
variables</em> so as a quick fix we could define a <em>mutable variable</em> outside the loop.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 29)" onmouseover="showTip(event, 'fs14', 29)" class="f">mapWithImmutableList</span> <span onmouseout="hideTip(event, 'fs4', 30)" onmouseover="showTip(event, 'fs4', 30)" class="f">f</span> (<span onmouseout="hideTip(event, 'fs15', 31)" onmouseover="showTip(event, 'fs15', 31)" class="i">list</span><span class="o">:</span>_ <span onmouseout="hideTip(event, 'fs15', 32)" onmouseover="showTip(event, 'fs15', 32)" class="t">list</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs16', 33)" onmouseover="showTip(event, 'fs16', 33)" class="v">acc</span> <span class="o">=</span> []
    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs7', 34)" onmouseover="showTip(event, 'fs7', 34)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs15', 35)" onmouseover="showTip(event, 'fs15', 35)" class="i">list</span> <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs16', 36)" onmouseover="showTip(event, 'fs16', 36)" class="v">acc</span> <span class="o">&lt;-</span> (<span onmouseout="hideTip(event, 'fs4', 37)" onmouseover="showTip(event, 'fs4', 37)" class="f">f</span> <span onmouseout="hideTip(event, 'fs7', 38)" onmouseover="showTip(event, 'fs7', 38)" class="i">x</span>) <span class="o">::</span> <span onmouseout="hideTip(event, 'fs16', 39)" onmouseover="showTip(event, 'fs16', 39)" class="v">acc</span>
    <span onmouseout="hideTip(event, 'fs16', 40)" onmouseover="showTip(event, 'fs16', 40)" class="v">acc</span>
</code></pre></td>
</tr>
</table>
<p>It doesn't mean we created a <em>mutable list</em> here. We still only have <em>immutable lists</em>.
But <code>acc</code> itself is <em>mutable</em> and can be changed to point to a new <em>immutable list</em>.</p>
<p>With <code>(f x) :: acc</code> we always create a whole new <em>immutable list</em> by using the <code>acc</code>
from the previous <em>loop iteration</em>. So <code>acc</code> only keeps track of the <em>last or newest</em>
<code>acc</code>.</p>
<p>This implementation still has a problem as we will also <em>reverse</em> the list. The problem
is that we only can prepend elements. So the second element get prepended to the new list.
The last element of the old list gets transformed and prepended as the new first element.</p>
<p>On top, we still relaying on <em>mutable</em> variables. Let's first forget about the <em>reverse</em>
problem. Here we see in general a problem. Looping needs <em>mutable</em> variables! Sure, we
also can do just some <em>side-effects</em> and don't <em>mutate</em> anything, but whenever you really
want to compute something you are forced to use <em>mutation</em> if you choose a loop.</p>
<p>Looping construct in general just don't work nicely together. That's also the reason why
looping is discouraged in functional programming. But it opens up the question how we
solve the problems that <em>looping</em> solves. How can we for example <em>loop</em> through an
<em>immutable list</em> without <em>looping</em>? And how can we achieve our goal without a
<em>mutable variable</em>?</p>
<p>The answer is: Through recursion!</p>
<h2>Looping with recursion</h2>
<p>To understand how we can replace loops through recursion, let's start with something simple. We
start with a typical <code>for</code> loop as you can see with <code>C#</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">for</span> (<span class="k">int</span> i=<span class="n">0</span>; i&lt;<span class="n">10</span>; i+<span class="o">+</span>) {
    Console.WriteLine(<span class="s">"{0}"</span>, i);
}
</code></pre></td></tr></table>
<p>If we really appreciate <em>immutability</em> we cannot directly create such a looping construct.
Because such a <code>for</code> loop relies on mutating <code>i</code> after every step. But it doesn't mean we can
calculate <code>i + 1</code>. We can increment <code>i</code>, but we have to assign the result to a new variable.
Technically we could expand the looping construct into separate statements.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 41)" onmouseover="showTip(event, 'fs17', 41)" class="i">i</span>  <span class="o">=</span> <span class="n">0</span>
<span onmouseout="hideTip(event, 'fs18', 42)" onmouseover="showTip(event, 'fs18', 42)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs17', 43)" onmouseover="showTip(event, 'fs17', 43)" class="i">i</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 44)" onmouseover="showTip(event, 'fs19', 44)" class="i">i1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 45)" onmouseover="showTip(event, 'fs17', 45)" class="i">i</span> <span class="o">+</span> <span class="n">1</span>
<span onmouseout="hideTip(event, 'fs18', 46)" onmouseover="showTip(event, 'fs18', 46)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs19', 47)" onmouseover="showTip(event, 'fs19', 47)" class="i">i1</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 48)" onmouseover="showTip(event, 'fs20', 48)" class="i">i2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 49)" onmouseover="showTip(event, 'fs19', 49)" class="i">i1</span> <span class="o">+</span> <span class="n">1</span>
<span onmouseout="hideTip(event, 'fs18', 50)" onmouseover="showTip(event, 'fs18', 50)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs20', 51)" onmouseover="showTip(event, 'fs20', 51)" class="i">i2</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 52)" onmouseover="showTip(event, 'fs21', 52)" class="i">i3</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 53)" onmouseover="showTip(event, 'fs20', 53)" class="i">i2</span> <span class="o">+</span> <span class="n">1</span>
<span onmouseout="hideTip(event, 'fs18', 54)" onmouseover="showTip(event, 'fs18', 54)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs21', 55)" onmouseover="showTip(event, 'fs21', 55)" class="i">i3</span>

<span class="c">// ...</span>
</code></pre></td>
</tr>
</table>
<p>Sure, writing stuff like that is simple stupid. We don't want to increment <code>i</code> ten times, always
create a new variable, and a new print statement. But it is still interesting that the idea
is the same with our <code>map</code> implementation.</p>
<p>We always create a new <em>immutable state</em>, by using the previous state. And that is where functions
come into play. Actually we are not limited to just assign the result of a calculation just to a
variable. We also can pass the result to a function.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 56)" onmouseover="showTip(event, 'fs22', 56)" class="i">calc</span> <span class="o">=</span> <span class="i">i</span> <span class="o">+</span> <span class="n">1</span>
<span class="i">f</span> <span onmouseout="hideTip(event, 'fs22', 57)" onmouseover="showTip(event, 'fs22', 57)" class="i">calc</span>
</code></pre></td>
</tr>
</table>
<p>or better, we can do it in one step.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">f</span> (<span class="i">i</span> <span class="o">+</span> <span class="n">1</span>)
</code></pre></td>
</tr>
</table>
<p>This is an important idea. It just means that when we call a function, it is also an assign statement
at the same time! With this idea, we can actually create a looping construct just out of functions.
Instead of mutating <code>i</code> at the end of a loop and repeating our loop. We just call our function
recursively and pass it the next state as an argument!</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs23', 58)" onmouseover="showTip(event, 'fs23', 58)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 59)" onmouseover="showTip(event, 'fs24', 59)" class="i">i</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs18', 60)" onmouseover="showTip(event, 'fs18', 60)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs24', 61)" onmouseover="showTip(event, 'fs24', 61)" class="i">i</span>
    <span onmouseout="hideTip(event, 'fs23', 62)" onmouseover="showTip(event, 'fs23', 62)" class="f">loop</span> (<span onmouseout="hideTip(event, 'fs24', 63)" onmouseover="showTip(event, 'fs24', 63)" class="i">i</span><span class="o">+</span><span class="n">1</span>)

<span onmouseout="hideTip(event, 'fs23', 64)" onmouseover="showTip(event, 'fs23', 64)" class="f">loop</span> <span class="n">0</span> <span class="c">// infinity loop</span>
</code></pre></td>
</tr>
</table>
<p>Sure, we now have another problem, as we currently have an infinity loop. We now <em>always</em> call <code>loop i+1</code>.
So we have to add some condition when we really want to loop.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs25', 65)" onmouseover="showTip(event, 'fs25', 65)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 66)" onmouseover="showTip(event, 'fs24', 66)" class="i">i</span> <span class="o">=</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 67)" onmouseover="showTip(event, 'fs24', 67)" class="i">i</span> <span class="o">&lt;</span> <span class="n">10</span> <span class="k">then</span> 
        <span onmouseout="hideTip(event, 'fs18', 68)" onmouseover="showTip(event, 'fs18', 68)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs24', 69)" onmouseover="showTip(event, 'fs24', 69)" class="i">i</span>
        <span onmouseout="hideTip(event, 'fs25', 70)" onmouseover="showTip(event, 'fs25', 70)" class="f">loop</span> (<span onmouseout="hideTip(event, 'fs24', 71)" onmouseover="showTip(event, 'fs24', 71)" class="i">i</span><span class="o">+</span><span class="n">1</span>)

<span onmouseout="hideTip(event, 'fs25', 72)" onmouseover="showTip(event, 'fs25', 72)" class="f">loop</span> <span class="n">0</span> <span class="c">// Will now print numbers from 0 to 9</span>
</code></pre></td>
</tr>
</table>
<p>Let's abstract it further. Instead of hard coding <code>10</code> we want to provide the end as an argument.
Additionally, we also want to be able to execute <em>any code</em> <em>inside our loop</em> iteration, instead
of hard-coding the <em>print-statement</em>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs26', 73)" onmouseover="showTip(event, 'fs26', 73)" class="f">forLoop</span> <span onmouseout="hideTip(event, 'fs24', 74)" onmouseover="showTip(event, 'fs24', 74)" class="i">i</span> <span onmouseout="hideTip(event, 'fs27', 75)" onmouseover="showTip(event, 'fs27', 75)" class="i">stop</span> <span onmouseout="hideTip(event, 'fs28', 76)" onmouseover="showTip(event, 'fs28', 76)" class="f">f</span> <span class="o">=</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 77)" onmouseover="showTip(event, 'fs24', 77)" class="i">i</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs27', 78)" onmouseover="showTip(event, 'fs27', 78)" class="i">stop</span> <span class="k">then</span>
        <span onmouseout="hideTip(event, 'fs28', 79)" onmouseover="showTip(event, 'fs28', 79)" class="f">f</span> <span onmouseout="hideTip(event, 'fs24', 80)" onmouseover="showTip(event, 'fs24', 80)" class="i">i</span>
        <span onmouseout="hideTip(event, 'fs26', 81)" onmouseover="showTip(event, 'fs26', 81)" class="f">forLoop</span> (<span onmouseout="hideTip(event, 'fs24', 82)" onmouseover="showTip(event, 'fs24', 82)" class="i">i</span><span class="o">+</span><span class="n">1</span>) <span onmouseout="hideTip(event, 'fs27', 83)" onmouseover="showTip(event, 'fs27', 83)" class="i">stop</span> <span onmouseout="hideTip(event, 'fs28', 84)" onmouseover="showTip(event, 'fs28', 84)" class="f">f</span>

<span onmouseout="hideTip(event, 'fs26', 85)" onmouseover="showTip(event, 'fs26', 85)" class="f">forLoop</span> <span class="n">0</span> <span class="n">10</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs24', 86)" onmouseover="showTip(event, 'fs24', 86)" class="i">i</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs18', 87)" onmouseover="showTip(event, 'fs18', 87)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs24', 88)" onmouseover="showTip(event, 'fs24', 88)" class="i">i</span>)
</code></pre></td>
</tr>
</table>
<p>We now basically recreated a <code>for</code> loop through a recursive function! We just can provide
the starting and the stop value and just provide a function for the <em>loop-body</em> that describes
what should be done at every step. The current <code>i</code> is just passed as an argument to our function
<code>f</code>. This way we can do something with the value.</p>
<p>Let's improve it a little bit. It feels a little bit awkward that we have
to provide <code>stop</code> and <code>f</code> again as arguments. We can fix this problem by just creating a special
<code>loop</code> function inside <code>forLoop</code> instead.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 89)" onmouseover="showTip(event, 'fs26', 89)" class="f">forLoop</span> <span onmouseout="hideTip(event, 'fs24', 90)" onmouseover="showTip(event, 'fs24', 90)" class="i">i</span> <span onmouseout="hideTip(event, 'fs27', 91)" onmouseover="showTip(event, 'fs27', 91)" class="i">stop</span> <span onmouseout="hideTip(event, 'fs28', 92)" onmouseover="showTip(event, 'fs28', 92)" class="f">f</span> <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs29', 93)" onmouseover="showTip(event, 'fs29', 93)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 94)" onmouseover="showTip(event, 'fs24', 94)" class="i">i</span> <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 95)" onmouseover="showTip(event, 'fs24', 95)" class="i">i</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs27', 96)" onmouseover="showTip(event, 'fs27', 96)" class="i">stop</span> <span class="k">then</span>
            <span onmouseout="hideTip(event, 'fs28', 97)" onmouseover="showTip(event, 'fs28', 97)" class="f">f</span> <span onmouseout="hideTip(event, 'fs24', 98)" onmouseover="showTip(event, 'fs24', 98)" class="i">i</span>
            <span onmouseout="hideTip(event, 'fs29', 99)" onmouseover="showTip(event, 'fs29', 99)" class="f">loop</span> (<span onmouseout="hideTip(event, 'fs24', 100)" onmouseover="showTip(event, 'fs24', 100)" class="i">i</span><span class="o">+</span><span class="n">1</span>)
    <span onmouseout="hideTip(event, 'fs29', 101)" onmouseover="showTip(event, 'fs29', 101)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 102)" onmouseover="showTip(event, 'fs24', 102)" class="i">i</span>

<span onmouseout="hideTip(event, 'fs26', 103)" onmouseover="showTip(event, 'fs26', 103)" class="f">forLoop</span> <span class="n">0</span> <span class="n">10</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs24', 104)" onmouseover="showTip(event, 'fs24', 104)" class="i">i</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs18', 105)" onmouseover="showTip(event, 'fs18', 105)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs24', 106)" onmouseover="showTip(event, 'fs24', 106)" class="i">i</span>)
</code></pre></td>
</tr>
</table>
<p>Our <code>forLoop</code> function is not a recursive function any more, instead it contains a recursive <code>loop</code>
function. <code>loop</code> only contains those variables as arguments that we really expect to change.</p>
<p>This has several advantages:</p>
<ol>
<li><code>loop</code> itself is easier and nearly resembles the first <code>loop</code> we started with.</li>
<li>
We don't need to pass variables like <code>f</code> or <code>stop</code> to the recursive call as we don't expect
them to change.
</li>
<li>
This reduces the possibility of bugs as we cannot change variables that we didn't expect to change.
For example, previously we could write: <code>forLoop (i+1) (stop+1) f</code>
</li>
<li>In other cases it also means we can <em>pre-</em> or <em>post-process</em> data</li>
<li>
Sometimes we just want to provide a fixed starting value. For example in a <code>sum</code> function
we provide <code>0</code> as the starting value. We don't want that the user must enter <code>0</code> as a
starting value for the recursion call!
</li>
</ol>
<p>The only problem so far is that we only can call functions that do some sort of side-effect.
But we cannot for example create something new out of the looping. For example if we want to
create the sum of all numbers from 0 to 9 we could write something like this in C#</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">int</span> sum <span class="o">=</span> <span class="n">0</span>
<span class="k">for</span> (<span class="k">int</span> i=<span class="n">0</span>; i&lt;<span class="n">10</span>; i+<span class="o">+</span>) {
    sum <span class="o">=</span> sum <span class="o">+</span> i;
}
</code></pre></td></tr></table>
<p>Fixing this problem should be easy. We just add <code>sum</code> to the <code>loop</code> function as this is a value
that we expect to change with every <em>iteration</em>. On top our function <code>f</code> must change. In the body
of a loop we have access to <code>i</code> and access to <code>sum</code> outside of the loop. We get access to those
data by passing both variables to the <code>f</code> function. But we also expect that the <code>f</code> function
returns a new version of <code>sum</code> that is then used for the next <em>recursive call</em>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs30', 107)" onmouseover="showTip(event, 'fs30', 107)" class="f">forLoop</span> <span onmouseout="hideTip(event, 'fs24', 108)" onmouseover="showTip(event, 'fs24', 108)" class="i">i</span> <span onmouseout="hideTip(event, 'fs27', 109)" onmouseover="showTip(event, 'fs27', 109)" class="i">stop</span> <span onmouseout="hideTip(event, 'fs31', 110)" onmouseover="showTip(event, 'fs31', 110)" class="f">f</span> <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs32', 111)" onmouseover="showTip(event, 'fs32', 111)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 112)" onmouseover="showTip(event, 'fs24', 112)" class="i">i</span> <span onmouseout="hideTip(event, 'fs33', 113)" onmouseover="showTip(event, 'fs33', 113)" class="i">sum</span> <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 114)" onmouseover="showTip(event, 'fs24', 114)" class="i">i</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs27', 115)" onmouseover="showTip(event, 'fs27', 115)" class="i">stop</span> <span class="k">then</span> 
            <span class="c">// create the next sum</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 116)" onmouseover="showTip(event, 'fs34', 116)" class="i">nextSum</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs31', 117)" onmouseover="showTip(event, 'fs31', 117)" class="f">f</span> <span onmouseout="hideTip(event, 'fs24', 118)" onmouseover="showTip(event, 'fs24', 118)" class="i">i</span> <span onmouseout="hideTip(event, 'fs33', 119)" onmouseover="showTip(event, 'fs33', 119)" class="i">sum</span>
            <span onmouseout="hideTip(event, 'fs32', 120)" onmouseover="showTip(event, 'fs32', 120)" class="f">loop</span> (<span onmouseout="hideTip(event, 'fs24', 121)" onmouseover="showTip(event, 'fs24', 121)" class="i">i</span><span class="o">+</span><span class="n">1</span>) <span onmouseout="hideTip(event, 'fs34', 122)" onmouseover="showTip(event, 'fs34', 122)" class="i">nextSum</span>
        <span class="k">else</span>
            <span class="c">// Return &quot;sum&quot; if we reached the end</span>
            <span onmouseout="hideTip(event, 'fs33', 123)" onmouseover="showTip(event, 'fs33', 123)" class="i">sum</span>
    <span onmouseout="hideTip(event, 'fs32', 124)" onmouseover="showTip(event, 'fs32', 124)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 125)" onmouseover="showTip(event, 'fs24', 125)" class="i">i</span> <span class="n">0</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 126)" onmouseover="showTip(event, 'fs35', 126)" class="i">sum</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs30', 127)" onmouseover="showTip(event, 'fs30', 127)" class="f">forLoop</span> <span class="n">0</span> <span class="n">10</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs24', 128)" onmouseover="showTip(event, 'fs24', 128)" class="i">i</span> <span onmouseout="hideTip(event, 'fs33', 129)" onmouseover="showTip(event, 'fs33', 129)" class="i">sum</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs33', 130)" onmouseover="showTip(event, 'fs33', 130)" class="i">sum</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs24', 131)" onmouseover="showTip(event, 'fs24', 131)" class="i">i</span>) <span class="c">// 45</span>
</code></pre></td>
</tr>
</table>
<p>The only thing I dislike at this point is that the usage of our <code>forLoop</code> is still limited. We have
the signature.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs36', 132)" onmouseover="showTip(event, 'fs36', 132)" class="f">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 133)" onmouseover="showTip(event, 'fs36', 133)" class="i">int</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs36', 134)" onmouseover="showTip(event, 'fs36', 134)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 135)" onmouseover="showTip(event, 'fs36', 135)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 136)" onmouseover="showTip(event, 'fs36', 136)" class="i">int</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 137)" onmouseover="showTip(event, 'fs36', 137)" class="i">int</span>
</code></pre></td>
</tr>
</table>
<p>It makes sense that <code>i</code> and <code>stop</code> are <code>int</code>. But usually we expect that the <em>looping-body</em> can work
with any type. Or in other words, that <code>sum</code> can be of any type. Currently we are limited to <code>int</code>
because we call <code>loop i 0</code> and directly pass <code>0</code> (an <code>int</code>) as <code>sum</code>. It makes more sense that the
user can provide the <em>initial-value</em>. And <code>f</code> just returns a new value of the same type. This
way, the <em>initial-value</em> can be generic.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs37', 138)" onmouseover="showTip(event, 'fs37', 138)" class="f">forLoop</span> <span onmouseout="hideTip(event, 'fs24', 139)" onmouseover="showTip(event, 'fs24', 139)" class="i">i</span> <span onmouseout="hideTip(event, 'fs27', 140)" onmouseover="showTip(event, 'fs27', 140)" class="i">stop</span> <span onmouseout="hideTip(event, 'fs38', 141)" onmouseover="showTip(event, 'fs38', 141)" class="i">init</span> <span onmouseout="hideTip(event, 'fs39', 142)" onmouseover="showTip(event, 'fs39', 142)" class="f">f</span> <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs40', 143)" onmouseover="showTip(event, 'fs40', 143)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 144)" onmouseover="showTip(event, 'fs24', 144)" class="i">i</span> <span onmouseout="hideTip(event, 'fs41', 145)" onmouseover="showTip(event, 'fs41', 145)" class="i">acc</span> <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 146)" onmouseover="showTip(event, 'fs24', 146)" class="i">i</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs27', 147)" onmouseover="showTip(event, 'fs27', 147)" class="i">stop</span> <span class="k">then</span> 
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 148)" onmouseover="showTip(event, 'fs42', 148)" class="i">nextAcc</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 149)" onmouseover="showTip(event, 'fs39', 149)" class="f">f</span> <span onmouseout="hideTip(event, 'fs24', 150)" onmouseover="showTip(event, 'fs24', 150)" class="i">i</span> <span onmouseout="hideTip(event, 'fs41', 151)" onmouseover="showTip(event, 'fs41', 151)" class="i">acc</span>
            <span onmouseout="hideTip(event, 'fs40', 152)" onmouseover="showTip(event, 'fs40', 152)" class="f">loop</span> (<span onmouseout="hideTip(event, 'fs24', 153)" onmouseover="showTip(event, 'fs24', 153)" class="i">i</span><span class="o">+</span><span class="n">1</span>) <span onmouseout="hideTip(event, 'fs42', 154)" onmouseover="showTip(event, 'fs42', 154)" class="i">nextAcc</span>
        <span class="k">else</span>
            <span onmouseout="hideTip(event, 'fs41', 155)" onmouseover="showTip(event, 'fs41', 155)" class="i">acc</span>
    <span onmouseout="hideTip(event, 'fs40', 156)" onmouseover="showTip(event, 'fs40', 156)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs24', 157)" onmouseover="showTip(event, 'fs24', 157)" class="i">i</span> <span onmouseout="hideTip(event, 'fs38', 158)" onmouseover="showTip(event, 'fs38', 158)" class="i">init</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 159)" onmouseover="showTip(event, 'fs35', 159)" class="i">sum</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs37', 160)" onmouseover="showTip(event, 'fs37', 160)" class="f">forLoop</span> <span class="n">0</span> <span class="n">10</span> <span class="n">0</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs24', 161)" onmouseover="showTip(event, 'fs24', 161)" class="i">i</span> <span onmouseout="hideTip(event, 'fs33', 162)" onmouseover="showTip(event, 'fs33', 162)" class="i">sum</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs33', 163)" onmouseover="showTip(event, 'fs33', 163)" class="i">sum</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs24', 164)" onmouseover="showTip(event, 'fs24', 164)" class="i">i</span>) <span class="c">// 45</span>
</code></pre></td>
</tr>
</table>
<p>We now have the signature:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs36', 165)" onmouseover="showTip(event, 'fs36', 165)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 166)" onmouseover="showTip(event, 'fs36', 166)" class="i">int</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs36', 167)" onmouseover="showTip(event, 'fs36', 167)" class="i">int</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">a</span>) <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">a</span>
</code></pre></td>
</tr>
</table>
<p>We now created a <code>forLoop</code> just with recursion and without any <em>mutable variable</em>. Our loop supports
the creation of any value. The function <code>f</code> just returns the next state (<code>acc</code>) that is used for
the next <em>iteration/recursion</em> and we don't contain any <em>mutable variable</em>.</p>
<p>Now we are not limited to <code>int</code> any more. Our <code>forLoop</code> can create any type. We could for example
build another list from it in an <em>immutable</em> way.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 168)" onmouseover="showTip(event, 'fs43', 168)" class="i">listOfNumbers</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs37', 169)" onmouseover="showTip(event, 'fs37', 169)" class="f">forLoop</span> <span class="n">0</span> <span class="n">10</span> [] (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs24', 170)" onmouseover="showTip(event, 'fs24', 170)" class="i">i</span> <span onmouseout="hideTip(event, 'fs44', 171)" onmouseover="showTip(event, 'fs44', 171)" class="i">list</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs24', 172)" onmouseover="showTip(event, 'fs24', 172)" class="i">i</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs44', 173)" onmouseover="showTip(event, 'fs44', 173)" class="i">list</span>)
<span class="c">// [9;8;7;6;5;4;3;2;1;0]</span>
</code></pre></td>
</tr>
</table>
<h2>Creating an immutable <code>foreach</code></h2>
<p>So far we only looped over numbers. But usually we want to loop over whole <em>data-structures</em>.
In C# we have <code>foreach</code> for this kind of idea. For example we can loop over a list in this way.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">var</span> sum <span class="o">=</span> <span class="n">0</span>;
<span class="k">foreach</span> ( <span class="k">var</span> x <span class="k">in</span> list ) {
    sum <span class="o">=</span> sum <span class="o">+</span> x
}
</code></pre></td></tr></table>
<p>We now want to do the same but with an <em>immutable F# list</em> instead, so how do we loop an
<em>immutable list</em>? Actually the only thing we can do with a F# list is either prepend some element
or use pattern matching to extract values from the beginning.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs45', 174)" onmouseover="showTip(event, 'fs45', 174)" class="i">numbers1</span> <span class="o">=</span> [<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>;<span class="n">5</span>]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 175)" onmouseover="showTip(event, 'fs46', 175)" class="i">numbers2</span> <span class="o">=</span> <span class="n">1</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs45', 176)" onmouseover="showTip(event, 'fs45', 176)" class="i">numbers1</span> <span class="c">// [1;2;3;4;5]</span>

<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs47', 177)" onmouseover="showTip(event, 'fs47', 177)" class="i">head</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs48', 178)" onmouseover="showTip(event, 'fs48', 178)" class="i">tail</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs46', 179)" onmouseover="showTip(event, 'fs46', 179)" class="i">numbers2</span>

<span onmouseout="hideTip(event, 'fs47', 180)" onmouseover="showTip(event, 'fs47', 180)" class="i">head</span> <span class="c">// 1</span>
<span onmouseout="hideTip(event, 'fs48', 181)" onmouseover="showTip(event, 'fs48', 181)" class="i">tail</span> <span class="c">// [2;3;4;5]</span>
</code></pre></td>
</tr>
</table>
<p>Doing the extraction with a <code>let</code> is usually discouraged because such an operation could fail.
If we have an empty list for example we couldn't extract the first element of a list. With
Pattern matching we can specify multiple cases that we can check. But as you already can imagine
again. This must be recursive again! Because we repeatedly want to extract one element from <code>tail</code>
and we sure don't want to write:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> (<span onmouseout="hideTip(event, 'fs49', 182)" onmouseover="showTip(event, 'fs49', 182)" class="i">head1</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs50', 183)" onmouseover="showTip(event, 'fs50', 183)" class="i">tail1</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs46', 184)" onmouseover="showTip(event, 'fs46', 184)" class="i">numbers2</span> <span class="c">// 1 [2;3;4;5]</span>
<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs51', 185)" onmouseover="showTip(event, 'fs51', 185)" class="i">head2</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs52', 186)" onmouseover="showTip(event, 'fs52', 186)" class="i">tail2</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs50', 187)" onmouseover="showTip(event, 'fs50', 187)" class="i">tail1</span>    <span class="c">// 2 [3;4;5]</span>
<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs53', 188)" onmouseover="showTip(event, 'fs53', 188)" class="i">head3</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs54', 189)" onmouseover="showTip(event, 'fs54', 189)" class="i">tail3</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs52', 190)" onmouseover="showTip(event, 'fs52', 190)" class="i">tail2</span>    <span class="c">// 3 [4;5]</span>
</code></pre></td>
</tr>
</table>
<p>And on top, we need an exit condition. We want to end as soon we end up with an empty list for <code>tail</code>.
Now let's do the same stuff we did with our <code>forLoop</code>. We expect some <em>initial value</em> that we can
specific as an <em>accumulator</em>. The <code>f</code> function now just gets the list element and our <em>accumulator</em>.
Once we end up with an empty list, we just return the <em>accumulator</em>. We call this function <code>fold</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs55', 191)" onmouseover="showTip(event, 'fs55', 191)" class="f">fold</span> <span onmouseout="hideTip(event, 'fs56', 192)" onmouseover="showTip(event, 'fs56', 192)" class="f">f</span> (<span onmouseout="hideTip(event, 'fs57', 193)" onmouseover="showTip(event, 'fs57', 193)" class="i">acc</span><span class="o">:</span><span class="o">&#39;</span><span class="i">State</span>) <span onmouseout="hideTip(event, 'fs15', 194)" onmouseover="showTip(event, 'fs15', 194)" class="i">list</span> <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs58', 195)" onmouseover="showTip(event, 'fs58', 195)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs59', 196)" onmouseover="showTip(event, 'fs59', 196)" class="i">remainingList</span> <span onmouseout="hideTip(event, 'fs57', 197)" onmouseover="showTip(event, 'fs57', 197)" class="i">acc</span> <span class="o">=</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs59', 198)" onmouseover="showTip(event, 'fs59', 198)" class="i">remainingList</span> <span class="k">with</span>
        | []         <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs57', 199)" onmouseover="showTip(event, 'fs57', 199)" class="i">acc</span>  <span class="c">// We return &quot;acc&quot; when we looped through the list</span>
        | <span onmouseout="hideTip(event, 'fs60', 200)" onmouseover="showTip(event, 'fs60', 200)" class="i">head</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs61', 201)" onmouseover="showTip(event, 'fs61', 201)" class="i">tail</span> <span class="k">-&gt;</span>      <span class="c">// extract first element of remainingList</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs62', 202)" onmouseover="showTip(event, 'fs62', 202)" class="i">nextAcc</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs56', 203)" onmouseover="showTip(event, 'fs56', 203)" class="f">f</span> <span onmouseout="hideTip(event, 'fs57', 204)" onmouseover="showTip(event, 'fs57', 204)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs60', 205)" onmouseover="showTip(event, 'fs60', 205)" class="i">head</span> <span class="c">// Compute the next accumulator</span>
            <span onmouseout="hideTip(event, 'fs58', 206)" onmouseover="showTip(event, 'fs58', 206)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs61', 207)" onmouseover="showTip(event, 'fs61', 207)" class="i">tail</span> <span onmouseout="hideTip(event, 'fs62', 208)" onmouseover="showTip(event, 'fs62', 208)" class="i">nextAcc</span>        <span class="c">// Recurse again with the new remaining list</span>
    <span onmouseout="hideTip(event, 'fs58', 209)" onmouseover="showTip(event, 'fs58', 209)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs15', 210)" onmouseover="showTip(event, 'fs15', 210)" class="i">list</span> <span onmouseout="hideTip(event, 'fs57', 211)" onmouseover="showTip(event, 'fs57', 211)" class="i">acc</span>
</code></pre></td>
</tr>
</table>
<p>I also changed the order of the arguments compared to the <code>forEach</code> function. We now
can <code>sum</code> a list of <code>int</code>s like that:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 212)" onmouseover="showTip(event, 'fs35', 212)" class="i">sum</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs55', 213)" onmouseover="showTip(event, 'fs55', 213)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs63', 214)" onmouseover="showTip(event, 'fs63', 214)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs13', 215)" onmouseover="showTip(event, 'fs13', 215)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs63', 216)" onmouseover="showTip(event, 'fs63', 216)" class="i">acc</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs13', 217)" onmouseover="showTip(event, 'fs13', 217)" class="i">x</span>) <span class="n">0</span> [<span class="n">1</span> <span class="o">..</span> <span class="n">9</span>] <span class="c">// 45</span>
</code></pre></td>
</tr>
</table>
<p>So, what is <code>fold</code> exactly? <code>fold</code> is just the idea of looping through a <em>data-structure</em>
in an <em>immutable way</em>. Instead of accessing a <em>mutable variable</em> that you access and <em>mutate</em> while
you are looping, you provide a function as the <em>loop-body</em>. The purpose of this function is to
calculate the next <em>accumulator</em> for the next iteration. Once the looping finished, <code>fold</code>
returns the <em>accumulator</em> you build.</p>
<h2>Creating <code>map</code></h2>
<p>Now that we abstracted the recursive looping in it's own function, we don't need to write a
recursive loop function anymore to traverse a list! We just can use <code>fold</code> for this purpose.</p>
<p>A first attempt to build <code>map</code> could look like that.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 218)" onmouseover="showTip(event, 'fs64', 218)" class="f">map</span> <span onmouseout="hideTip(event, 'fs4', 219)" onmouseover="showTip(event, 'fs4', 219)" class="f">f</span> <span onmouseout="hideTip(event, 'fs15', 220)" onmouseover="showTip(event, 'fs15', 220)" class="i">list</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs55', 221)" onmouseover="showTip(event, 'fs55', 221)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs65', 222)" onmouseover="showTip(event, 'fs65', 222)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs7', 223)" onmouseover="showTip(event, 'fs7', 223)" class="i">x</span> <span class="k">-&gt;</span> <span class="c">// foreach (var x in list )</span>
        (<span onmouseout="hideTip(event, 'fs4', 224)" onmouseover="showTip(event, 'fs4', 224)" class="f">f</span> <span onmouseout="hideTip(event, 'fs7', 225)" onmouseover="showTip(event, 'fs7', 225)" class="i">x</span>) <span class="o">::</span> <span onmouseout="hideTip(event, 'fs65', 226)" onmouseover="showTip(event, 'fs65', 226)" class="i">acc</span>   <span class="c">//     nextAcc &lt;- (f x) :: acc</span>
    ) [] <span onmouseout="hideTip(event, 'fs15', 227)" onmouseover="showTip(event, 'fs15', 227)" class="i">list</span>          <span class="c">// Start with &quot;[]&quot; as &quot;acc&quot; and go through &quot;list&quot;</span>

<span onmouseout="hideTip(event, 'fs64', 228)" onmouseover="showTip(event, 'fs64', 228)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 229)" onmouseover="showTip(event, 'fs13', 229)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs13', 230)" onmouseover="showTip(event, 'fs13', 230)" class="i">x</span> <span class="o">*</span> <span class="n">2</span>) [<span class="n">0..</span><span class="n">9</span>]
<span class="c">// [18; 16; 14; 12; 10; 8; 6; 4; 2; 0]</span>
</code></pre></td>
</tr>
</table>
<p>But we still have the same problem as in the beginning. The list is reversed because we <em>prepend</em>
and not <em>append</em> elements. As we cannot <em>append</em> we have to provide another solution.</p>
<p>Besides a <code>fold</code> we usually also provide a <code>foldBack</code>. A <code>foldBack</code> just traverses a data-structure
backwards or from <em>right-to-left</em> instead of <em>left-to-right</em>.</p>
<p>But we also cannot easily go through a list backwards, an easy fix to this solution is when we implement
<code>foldBack</code> by first <em>reversing</em> the input list and then use <code>fold</code>. After we have <code>foldBack</code> we can
define <code>map</code> with <code>foldBack</code> instead of <code>fold</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Reverses a List</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 231)" onmouseover="showTip(event, 'fs66', 231)" class="f">rev</span> <span onmouseout="hideTip(event, 'fs15', 232)" onmouseover="showTip(event, 'fs15', 232)" class="i">list</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs55', 233)" onmouseover="showTip(event, 'fs55', 233)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs67', 234)" onmouseover="showTip(event, 'fs67', 234)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs7', 235)" onmouseover="showTip(event, 'fs7', 235)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs7', 236)" onmouseover="showTip(event, 'fs7', 236)" class="i">x</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs67', 237)" onmouseover="showTip(event, 'fs67', 237)" class="i">acc</span>) [] <span onmouseout="hideTip(event, 'fs15', 238)" onmouseover="showTip(event, 'fs15', 238)" class="i">list</span>

<span class="c">// foldBack loops through the list from the end to start</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 239)" onmouseover="showTip(event, 'fs68', 239)" class="f">foldBack</span> <span onmouseout="hideTip(event, 'fs69', 240)" onmouseover="showTip(event, 'fs69', 240)" class="f">f</span> <span onmouseout="hideTip(event, 'fs15', 241)" onmouseover="showTip(event, 'fs15', 241)" class="i">list</span> (<span onmouseout="hideTip(event, 'fs57', 242)" onmouseover="showTip(event, 'fs57', 242)" class="i">acc</span><span class="o">:</span><span class="o">&#39;</span><span class="i">State</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs55', 243)" onmouseover="showTip(event, 'fs55', 243)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs57', 244)" onmouseover="showTip(event, 'fs57', 244)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs7', 245)" onmouseover="showTip(event, 'fs7', 245)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs69', 246)" onmouseover="showTip(event, 'fs69', 246)" class="f">f</span> <span onmouseout="hideTip(event, 'fs7', 247)" onmouseover="showTip(event, 'fs7', 247)" class="i">x</span> <span onmouseout="hideTip(event, 'fs57', 248)" onmouseover="showTip(event, 'fs57', 248)" class="i">acc</span>) <span onmouseout="hideTip(event, 'fs57', 249)" onmouseover="showTip(event, 'fs57', 249)" class="i">acc</span> (<span onmouseout="hideTip(event, 'fs66', 250)" onmouseover="showTip(event, 'fs66', 250)" class="f">rev</span> <span onmouseout="hideTip(event, 'fs15', 251)" onmouseover="showTip(event, 'fs15', 251)" class="i">list</span>)

<span class="c">// map defined in terms of foldBack</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 252)" onmouseover="showTip(event, 'fs64', 252)" class="f">map</span> <span onmouseout="hideTip(event, 'fs4', 253)" onmouseover="showTip(event, 'fs4', 253)" class="f">f</span> <span onmouseout="hideTip(event, 'fs15', 254)" onmouseover="showTip(event, 'fs15', 254)" class="i">list</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs68', 255)" onmouseover="showTip(event, 'fs68', 255)" class="f">foldBack</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs7', 256)" onmouseover="showTip(event, 'fs7', 256)" class="i">x</span> <span onmouseout="hideTip(event, 'fs65', 257)" onmouseover="showTip(event, 'fs65', 257)" class="i">acc</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs4', 258)" onmouseover="showTip(event, 'fs4', 258)" class="f">f</span> <span onmouseout="hideTip(event, 'fs7', 259)" onmouseover="showTip(event, 'fs7', 259)" class="i">x</span>) <span class="o">::</span> <span onmouseout="hideTip(event, 'fs65', 260)" onmouseover="showTip(event, 'fs65', 260)" class="i">acc</span>) <span onmouseout="hideTip(event, 'fs15', 261)" onmouseover="showTip(event, 'fs15', 261)" class="i">list</span> []

<span class="c">// Now we get the right result</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 262)" onmouseover="showTip(event, 'fs70', 262)" class="i">numbers</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 263)" onmouseover="showTip(event, 'fs64', 263)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 264)" onmouseover="showTip(event, 'fs13', 264)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs13', 265)" onmouseover="showTip(event, 'fs13', 265)" class="i">x</span> <span class="o">*</span> <span class="n">2</span>) [<span class="n">1</span> <span class="o">..</span> <span class="n">9</span>]
<span class="c">// [2; 4; 6; 8; 10; 12; 14; 16; 18]</span>
</code></pre></td>
</tr>
</table>
<p>Probably you wonder why we choose different argument orders for <code>fold</code> and <code>foldBack</code> including the
arguments for the <code>f</code> function. In <code>fold</code> we first have <code>acc</code> then <code>x</code>, in <code>foldBack</code> it is reversed.
<code>x</code> then <code>acc</code>. The reason is, the position of <code>acc</code> <em>resembles</em> the order how we traverse the list.</p>
<p>In <code>fold</code> we go from left to right. We start with the initial <code>acc</code>, we extract the first value
from our list and we somehow <em>combine</em> it with the already present <code>acc</code>. Let's visualize the
steps that code like this do:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 266)" onmouseover="showTip(event, 'fs35', 266)" class="i">sum</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs55', 267)" onmouseover="showTip(event, 'fs55', 267)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs63', 268)" onmouseover="showTip(event, 'fs63', 268)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs13', 269)" onmouseover="showTip(event, 'fs13', 269)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs63', 270)" onmouseover="showTip(event, 'fs63', 270)" class="i">acc</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs13', 271)" onmouseover="showTip(event, 'fs13', 271)" class="i">x</span>) <span class="n">0</span> [<span class="n">1..</span><span class="n">5</span>]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">acc</span> | <span onmouseout="hideTip(event, 'fs71', 272)" onmouseover="showTip(event, 'fs71', 272)" class="i">list</span>        | <span class="i">acc</span> <span class="o">+</span> <span class="i">x</span>
<span class="o">-----------------------------</span>
<span class="n">0</span>   | [<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>;<span class="n">5</span>] | <span class="n">0</span> <span class="o">+</span> <span class="n">1</span>
<span class="n">1</span>   | [<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>;<span class="n">5</span>]   | <span class="n">1</span> <span class="o">+</span> <span class="n">2</span>
<span class="n">3</span>   | [<span class="n">3</span>;<span class="n">4</span>;<span class="n">5</span>]     | <span class="n">3</span> <span class="o">+</span> <span class="n">3</span>
<span class="n">6</span>   | [<span class="n">4</span>;<span class="n">5</span>]       | <span class="n">6</span> <span class="o">+</span> <span class="n">4</span>
<span class="n">10</span>  | [<span class="n">5</span>]         | <span class="n">10</span> <span class="o">+</span> <span class="n">5</span>
<span class="n">15</span>  | []          | <span class="k">return</span> <span class="k">-&gt;</span> <span class="n">15</span>
</code></pre></td>
</tr>
</table>
<p>When we use <code>foldBack</code> we get the same result, but we go from right to left.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 273)" onmouseover="showTip(event, 'fs35', 273)" class="i">sum</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs68', 274)" onmouseover="showTip(event, 'fs68', 274)" class="f">foldBack</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 275)" onmouseover="showTip(event, 'fs13', 275)" class="i">x</span> <span onmouseout="hideTip(event, 'fs63', 276)" onmouseover="showTip(event, 'fs63', 276)" class="i">acc</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs13', 277)" onmouseover="showTip(event, 'fs13', 277)" class="i">x</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs63', 278)" onmouseover="showTip(event, 'fs63', 278)" class="i">acc</span>) [<span class="n">1..</span><span class="n">5</span>] <span class="n">0</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs71', 279)" onmouseover="showTip(event, 'fs71', 279)" class="i">list</span>        | <span class="i">acc</span> | <span class="i">x</span> <span class="o">+</span> <span class="i">acc</span>
<span class="o">---------------------------</span>
[<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>;<span class="n">5</span>] | <span class="n">0</span>   | <span class="n">5</span> <span class="o">+</span> <span class="n">0</span>
  [<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>] | <span class="n">5</span>   | <span class="n">4</span> <span class="o">+</span> <span class="n">5</span>
    [<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>] | <span class="n">9</span>   | <span class="n">3</span> <span class="o">+</span> <span class="n">9</span>
      [<span class="n">1</span>;<span class="n">2</span>] | <span class="n">12</span>  | <span class="n">2</span> <span class="o">+</span> <span class="n">12</span>
        [<span class="n">1</span>] | <span class="n">14</span>  | <span class="n">1</span> <span class="o">+</span> <span class="n">14</span>
         [] | <span class="n">15</span>  | <span class="k">return</span> <span class="k">-&gt;</span> <span class="n">15</span>
</code></pre></td>
</tr>
</table>
<p>That's why we use <code>acc x</code> in <code>fold</code> and <code>x acc</code> in <code>foldBack</code>. For summing numbers this
doesn't make any difference, but for other operations like <code>map</code> it does!</p>
<h2><code>length</code>, <code>filter</code>, <code>iter</code>, <code>append</code>, <code>concat</code> and <code>collect</code></h2>
<p>Let's create some more functions. As an exercise you also can try to first implement
those functions yourself.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Length</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 280)" onmouseover="showTip(event, 'fs72', 280)" class="f">length</span> <span onmouseout="hideTip(event, 'fs73', 281)" onmouseover="showTip(event, 'fs73', 281)" class="i">xs</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs55', 282)" onmouseover="showTip(event, 'fs55', 282)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs63', 283)" onmouseover="showTip(event, 'fs63', 283)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs7', 284)" onmouseover="showTip(event, 'fs7', 284)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs63', 285)" onmouseover="showTip(event, 'fs63', 285)" class="i">acc</span> <span class="o">+</span> <span class="n">1</span>) <span class="n">0</span> <span onmouseout="hideTip(event, 'fs73', 286)" onmouseover="showTip(event, 'fs73', 286)" class="i">xs</span>

<span onmouseout="hideTip(event, 'fs72', 287)" onmouseover="showTip(event, 'fs72', 287)" class="f">length</span> [<span class="n">1..</span><span class="n">10</span>] <span class="c">// 10</span>

<span class="c">// Filter</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs74', 288)" onmouseover="showTip(event, 'fs74', 288)" class="f">filter</span> <span onmouseout="hideTip(event, 'fs75', 289)" onmouseover="showTip(event, 'fs75', 289)" class="f">predicate</span> <span onmouseout="hideTip(event, 'fs73', 290)" onmouseover="showTip(event, 'fs73', 290)" class="i">xs</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs68', 291)" onmouseover="showTip(event, 'fs68', 291)" class="f">foldBack</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs7', 292)" onmouseover="showTip(event, 'fs7', 292)" class="i">x</span> <span onmouseout="hideTip(event, 'fs67', 293)" onmouseover="showTip(event, 'fs67', 293)" class="i">acc</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs75', 294)" onmouseover="showTip(event, 'fs75', 294)" class="f">predicate</span> <span onmouseout="hideTip(event, 'fs7', 295)" onmouseover="showTip(event, 'fs7', 295)" class="i">x</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs7', 296)" onmouseover="showTip(event, 'fs7', 296)" class="i">x</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs67', 297)" onmouseover="showTip(event, 'fs67', 297)" class="i">acc</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs67', 298)" onmouseover="showTip(event, 'fs67', 298)" class="i">acc</span>) <span onmouseout="hideTip(event, 'fs73', 299)" onmouseover="showTip(event, 'fs73', 299)" class="i">xs</span> []

<span onmouseout="hideTip(event, 'fs74', 300)" onmouseover="showTip(event, 'fs74', 300)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 301)" onmouseover="showTip(event, 'fs13', 301)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs13', 302)" onmouseover="showTip(event, 'fs13', 302)" class="i">x</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span> <span class="n">0</span>) [<span class="n">1..</span><span class="n">10</span>] <span class="c">// [2;4;6;8;10]</span>

<span class="c">// Iter</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs76', 303)" onmouseover="showTip(event, 'fs76', 303)" class="f">iter</span> <span onmouseout="hideTip(event, 'fs77', 304)" onmouseover="showTip(event, 'fs77', 304)" class="f">f</span> <span onmouseout="hideTip(event, 'fs73', 305)" onmouseover="showTip(event, 'fs73', 305)" class="i">xs</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs55', 306)" onmouseover="showTip(event, 'fs55', 306)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs78', 307)" onmouseover="showTip(event, 'fs78', 307)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs7', 308)" onmouseover="showTip(event, 'fs7', 308)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs77', 309)" onmouseover="showTip(event, 'fs77', 309)" class="f">f</span> <span onmouseout="hideTip(event, 'fs7', 310)" onmouseover="showTip(event, 'fs7', 310)" class="i">x</span>) () <span onmouseout="hideTip(event, 'fs73', 311)" onmouseover="showTip(event, 'fs73', 311)" class="i">xs</span>

<span onmouseout="hideTip(event, 'fs76', 312)" onmouseover="showTip(event, 'fs76', 312)" class="f">iter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 313)" onmouseover="showTip(event, 'fs13', 313)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs18', 314)" onmouseover="showTip(event, 'fs18', 314)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs13', 315)" onmouseover="showTip(event, 'fs13', 315)" class="i">x</span>) [<span class="n">1..</span><span class="n">5</span>] <span class="c">// Prints numbers 1 to 5 on a line</span>

<span class="c">// Append</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs79', 316)" onmouseover="showTip(event, 'fs79', 316)" class="f">append</span> <span onmouseout="hideTip(event, 'fs73', 317)" onmouseover="showTip(event, 'fs73', 317)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs80', 318)" onmouseover="showTip(event, 'fs80', 318)" class="i">ys</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs68', 319)" onmouseover="showTip(event, 'fs68', 319)" class="f">foldBack</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs7', 320)" onmouseover="showTip(event, 'fs7', 320)" class="i">x</span> <span onmouseout="hideTip(event, 'fs67', 321)" onmouseover="showTip(event, 'fs67', 321)" class="i">acc</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs7', 322)" onmouseover="showTip(event, 'fs7', 322)" class="i">x</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs67', 323)" onmouseover="showTip(event, 'fs67', 323)" class="i">acc</span>) <span onmouseout="hideTip(event, 'fs73', 324)" onmouseover="showTip(event, 'fs73', 324)" class="i">xs</span> <span onmouseout="hideTip(event, 'fs80', 325)" onmouseover="showTip(event, 'fs80', 325)" class="i">ys</span>

<span onmouseout="hideTip(event, 'fs79', 326)" onmouseover="showTip(event, 'fs79', 326)" class="f">append</span> [<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>] [<span class="n">4</span>;<span class="n">5</span>;<span class="n">6</span>] <span class="c">// [1;2;3;4;5;6]</span>

<span class="c">// concat</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs81', 327)" onmouseover="showTip(event, 'fs81', 327)" class="f">concat</span> <span onmouseout="hideTip(event, 'fs82', 328)" onmouseover="showTip(event, 'fs82', 328)" class="i">lol</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs55', 329)" onmouseover="showTip(event, 'fs55', 329)" class="f">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs67', 330)" onmouseover="showTip(event, 'fs67', 330)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs83', 331)" onmouseover="showTip(event, 'fs83', 331)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs79', 332)" onmouseover="showTip(event, 'fs79', 332)" class="f">append</span> <span onmouseout="hideTip(event, 'fs67', 333)" onmouseover="showTip(event, 'fs67', 333)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs83', 334)" onmouseover="showTip(event, 'fs83', 334)" class="i">x</span>) [] <span onmouseout="hideTip(event, 'fs82', 335)" onmouseover="showTip(event, 'fs82', 335)" class="i">lol</span>

<span onmouseout="hideTip(event, 'fs81', 336)" onmouseover="showTip(event, 'fs81', 336)" class="f">concat</span> [[<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>]; [<span class="n">4</span>;<span class="n">5</span>;<span class="n">6</span>]; [<span class="n">7</span>;<span class="n">8</span>;<span class="n">9</span>]] <span class="c">// [1;2;3;4;5;6;7;8;9]</span>

<span class="c">// collect</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs84', 337)" onmouseover="showTip(event, 'fs84', 337)" class="f">collect</span> <span onmouseout="hideTip(event, 'fs85', 338)" onmouseover="showTip(event, 'fs85', 338)" class="f">f</span> <span onmouseout="hideTip(event, 'fs73', 339)" onmouseover="showTip(event, 'fs73', 339)" class="i">xs</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs64', 340)" onmouseover="showTip(event, 'fs64', 340)" class="f">map</span> <span onmouseout="hideTip(event, 'fs85', 341)" onmouseover="showTip(event, 'fs85', 341)" class="f">f</span> <span onmouseout="hideTip(event, 'fs73', 342)" onmouseover="showTip(event, 'fs73', 342)" class="i">xs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs81', 343)" onmouseover="showTip(event, 'fs81', 343)" class="f">concat</span>

<span onmouseout="hideTip(event, 'fs84', 344)" onmouseover="showTip(event, 'fs84', 344)" class="f">collect</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 345)" onmouseover="showTip(event, 'fs13', 345)" class="i">x</span> <span class="k">-&gt;</span> [<span onmouseout="hideTip(event, 'fs13', 346)" onmouseover="showTip(event, 'fs13', 346)" class="i">x</span>;<span onmouseout="hideTip(event, 'fs13', 347)" onmouseover="showTip(event, 'fs13', 347)" class="i">x</span>;<span onmouseout="hideTip(event, 'fs13', 348)" onmouseover="showTip(event, 'fs13', 348)" class="i">x</span>]) [<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>] <span class="c">// [1;1;1;2;2;2;3;3;3]</span>
</code></pre></td>
</tr>
</table>
<p>From the implementation i think only <code>append</code>, <code>concat</code> and <code>collect</code> are interesting.</p>
<p>In <code>append</code> you see that you don't have to start from an empty list. Appending two list basically
means you prepend the first list to the second list by going backwards through the first list. So
the second list is your starting <em>accumulator</em>.</p>
<p>With <code>append</code> in place, <code>concat</code> becomes easy. As you just repeatedly append two lists to a single
one.</p>
<p>And once you have <code>concat</code>, it is also pretty easy to implement <code>collect</code> through <code>map</code> and <code>concat</code>.</p>
<h2>Summary</h2>
<p>We first started with some loops that modifies <em>mutable variables</em>. In order to get rid of <em>mutable</em>
variables or to work with <em>immutable data-structures</em> we need recursion. Without <em>recursion</em>
it is basically impossible to effectively work with <em>immutable data-structures</em>. But this doesn't mean
we always have to write recursive functions.</p>
<p>We start by implementing a <code>fold</code> function that does the same thing as a <code>foreach</code> loop just in
an <em>immutable</em> way. With <code>fold</code> we abstracted the <em>recursive looping</em> in it's own function.
New functions can now be implemented on top of <code>fold</code> or the function we created with <code>fold</code>.</p>
<p>While <em>recursion</em> is indeed an important aspect of functional programming, as we just need it to
work with <em>immutable data</em>. It doesn't mean we should use <em>recursion</em> all over the place. The use
of <em>recursion</em> is often a sign that we lack abstraction.</p>


<div class="tip" id="fs1">module Main</div>
<div class="tip" id="fs2">type ResizeArray&lt;&#39;T&gt; = System.Collections.Generic.List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.ResizeArray&lt;_&gt;</div>
<div class="tip" id="fs3">val map : f:(&#39;a -&gt; &#39;b) -&gt; oldArray:seq&lt;&#39;a&gt; -&gt; System.Collections.Generic.List&lt;&#39;b&gt;<br /><br />Full name: Main.ResizeArray.map</div>
<div class="tip" id="fs4">val f : (&#39;a -&gt; &#39;b)</div>
<div class="tip" id="fs5">val oldArray : seq&lt;&#39;a&gt;</div>
<div class="tip" id="fs6">val newArray : System.Collections.Generic.List&lt;&#39;b&gt;</div>
<div class="tip" id="fs7">val x : &#39;a</div>
<div class="tip" id="fs8">System.Collections.Generic.List.Add(item: &#39;b) : unit</div>
<div class="tip" id="fs9">val numbers : System.Collections.Generic.List&lt;int&gt;<br /><br />Full name: Main.numbers</div>
<div class="tip" id="fs10">Multiple items<br />module ResizeArray<br /><br />from Main<br /><br />--------------------<br />type ResizeArray&lt;&#39;T&gt; = System.Collections.Generic.List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.ResizeArray&lt;_&gt;</div>
<div class="tip" id="fs11">System.Collections.Generic.List.Add(item: int) : unit</div>
<div class="tip" id="fs12">val squaredNumbers : System.Collections.Generic.List&lt;int&gt;<br /><br />Full name: Main.squaredNumbers</div>
<div class="tip" id="fs13">val x : int</div>
<div class="tip" id="fs14">val mapWithImmutableList : f:(&#39;a -&gt; &#39;b) -&gt; list:&#39;a list -&gt; &#39;b list<br /><br />Full name: Main.mapWithImmutableList</div>
<div class="tip" id="fs15">Multiple items<br />val list : &#39;a list<br /><br />--------------------<br />type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs16">val mutable acc : &#39;b list</div>
<div class="tip" id="fs17">val i : int<br /><br />Full name: Main.i</div>
<div class="tip" id="fs18">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs19">val i1 : int<br /><br />Full name: Main.i1</div>
<div class="tip" id="fs20">val i2 : int<br /><br />Full name: Main.i2</div>
<div class="tip" id="fs21">val i3 : int<br /><br />Full name: Main.i3</div>
<div class="tip" id="fs22">val calc : int<br /><br />Full name: mutableloopstoimmutability.calc</div>
<div class="tip" id="fs23">val loop : i:int -&gt; &#39;a<br /><br />Full name: Main.loop</div>
<div class="tip" id="fs24">val i : int</div>
<div class="tip" id="fs25">val loop : i:int -&gt; unit<br /><br />Full name: Main.loop</div>
<div class="tip" id="fs26">val forLoop : i:int -&gt; stop:int -&gt; f:(int -&gt; unit) -&gt; unit<br /><br />Full name: Main.forLoop</div>
<div class="tip" id="fs27">val stop : int</div>
<div class="tip" id="fs28">val f : (int -&gt; unit)</div>
<div class="tip" id="fs29">val loop : (int -&gt; unit)</div>
<div class="tip" id="fs30">val forLoop : i:int -&gt; stop:int -&gt; f:(int -&gt; int -&gt; int) -&gt; int<br /><br />Full name: Main.forLoop</div>
<div class="tip" id="fs31">val f : (int -&gt; int -&gt; int)</div>
<div class="tip" id="fs32">val loop : (int -&gt; int -&gt; int)</div>
<div class="tip" id="fs33">val sum : int</div>
<div class="tip" id="fs34">val nextSum : int</div>
<div class="tip" id="fs35">val sum : int<br /><br />Full name: Main.sum</div>
<div class="tip" id="fs36">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs37">val forLoop : i:int -&gt; stop:int -&gt; init:&#39;a -&gt; f:(int -&gt; &#39;a -&gt; &#39;a) -&gt; &#39;a<br /><br />Full name: Main.forLoop</div>
<div class="tip" id="fs38">val init : &#39;a</div>
<div class="tip" id="fs39">val f : (int -&gt; &#39;a -&gt; &#39;a)</div>
<div class="tip" id="fs40">val loop : (int -&gt; &#39;a -&gt; &#39;a)</div>
<div class="tip" id="fs41">val acc : &#39;a</div>
<div class="tip" id="fs42">val nextAcc : &#39;a</div>
<div class="tip" id="fs43">val listOfNumbers : int list<br /><br />Full name: Main.listOfNumbers</div>
<div class="tip" id="fs44">Multiple items<br />val list : int list<br /><br />--------------------<br />type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs45">val numbers1 : int list<br /><br />Full name: Main.numbers1</div>
<div class="tip" id="fs46">val numbers2 : int list<br /><br />Full name: Main.numbers2</div>
<div class="tip" id="fs47">val head : int<br /><br />Full name: Main.head</div>
<div class="tip" id="fs48">val tail : int list<br /><br />Full name: Main.tail</div>
<div class="tip" id="fs49">val head1 : int<br /><br />Full name: Main.head1</div>
<div class="tip" id="fs50">val tail1 : int list<br /><br />Full name: Main.tail1</div>
<div class="tip" id="fs51">val head2 : int<br /><br />Full name: Main.head2</div>
<div class="tip" id="fs52">val tail2 : int list<br /><br />Full name: Main.tail2</div>
<div class="tip" id="fs53">val head3 : int<br /><br />Full name: Main.head3</div>
<div class="tip" id="fs54">val tail3 : int list<br /><br />Full name: Main.tail3</div>
<div class="tip" id="fs55">val fold : f:(&#39;State -&gt; &#39;a -&gt; &#39;State) -&gt; acc:&#39;State -&gt; list:&#39;a list -&gt; &#39;State<br /><br />Full name: Main.fold</div>
<div class="tip" id="fs56">val f : (&#39;State -&gt; &#39;a -&gt; &#39;State)</div>
<div class="tip" id="fs57">val acc : &#39;State</div>
<div class="tip" id="fs58">val loop : (&#39;a list -&gt; &#39;State -&gt; &#39;State)</div>
<div class="tip" id="fs59">val remainingList : &#39;a list</div>
<div class="tip" id="fs60">val head : &#39;a</div>
<div class="tip" id="fs61">val tail : &#39;a list</div>
<div class="tip" id="fs62">val nextAcc : &#39;State</div>
<div class="tip" id="fs63">val acc : int</div>
<div class="tip" id="fs64">val map : f:(&#39;a -&gt; &#39;b) -&gt; list:&#39;a list -&gt; &#39;b list<br /><br />Full name: Main.map</div>
<div class="tip" id="fs65">val acc : &#39;b list</div>
<div class="tip" id="fs66">val rev : list:&#39;a list -&gt; &#39;a list<br /><br />Full name: Main.rev</div>
<div class="tip" id="fs67">val acc : &#39;a list</div>
<div class="tip" id="fs68">val foldBack : f:(&#39;a -&gt; &#39;State -&gt; &#39;State) -&gt; list:&#39;a list -&gt; acc:&#39;State -&gt; &#39;State<br /><br />Full name: Main.foldBack</div>
<div class="tip" id="fs69">val f : (&#39;a -&gt; &#39;State -&gt; &#39;State)</div>
<div class="tip" id="fs70">val numbers : int list<br /><br />Full name: Main.numbers</div>
<div class="tip" id="fs71">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs72">val length : xs:&#39;a list -&gt; int<br /><br />Full name: Main.length</div>
<div class="tip" id="fs73">val xs : &#39;a list</div>
<div class="tip" id="fs74">val filter : predicate:(&#39;a -&gt; bool) -&gt; xs:&#39;a list -&gt; &#39;a list<br /><br />Full name: Main.filter</div>
<div class="tip" id="fs75">val predicate : (&#39;a -&gt; bool)</div>
<div class="tip" id="fs76">val iter : f:(&#39;a -&gt; unit) -&gt; xs:&#39;a list -&gt; unit<br /><br />Full name: Main.iter</div>
<div class="tip" id="fs77">val f : (&#39;a -&gt; unit)</div>
<div class="tip" id="fs78">val acc : unit</div>
<div class="tip" id="fs79">val append : xs:&#39;a list -&gt; ys:&#39;a list -&gt; &#39;a list<br /><br />Full name: Main.append</div>
<div class="tip" id="fs80">val ys : &#39;a list</div>
<div class="tip" id="fs81">val concat : lol:&#39;a list list -&gt; &#39;a list<br /><br />Full name: Main.concat</div>
<div class="tip" id="fs82">val lol : &#39;a list list</div>
<div class="tip" id="fs83">val x : &#39;a list</div>
<div class="tip" id="fs84">val collect : f:(&#39;a -&gt; &#39;b list) -&gt; xs:&#39;a list -&gt; &#39;b list<br /><br />Full name: Main.collect</div>
<div class="tip" id="fs85">val f : (&#39;a -&gt; &#39;b list)</div>
